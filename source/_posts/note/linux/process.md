---
title: Linux 之进程管理
categories:
- note 
---
以 Centos 为标准，这章说进程管理。
<!--more-->
### 一、基础
#### 1.1、概念
- 程序：通常为二进制程序放置存储媒介中，以物理文件的形式存在
- 进程：程序被触发后，执行者的权限与属性、程序的代码与所需数据等都会被加载到内存中，可以说进程就是一个正在进行中的程序
- 系统服务：常驻内存的进程，被称为服务

#### 1.2、命令执行的判断依据
- `;` 不考虑命令相关性的连续命令执行
- `&&` 前面执行正确才继续执行
- `||` 前面执行错误才继续执行

### 二、工作管理
- &：直接将命令丢到后台中“执行”

```
<!--由于没有加上数据流重定向，所以会影响界面，不会影响前台的操作-->
tar -zpcf /tmp/etc.tar.gz /etc &

<!--利用数据流重定向，将输出数据传送至某个文件中，2>&1 表示将错误重定向到标准输出上-->
tar -zpcvf /tmp/etc.tar.gz /etc > /tmp/log.txt 2>&1 &
```
- kill：管理后台当中的工作

```
<!--列出目前kill能够使用的信号-->
kill -l

kill -signal %jobnumber
-1：重新读取一次参数的配置文件
-9：立刻强制删除一个工作
-15：以正常的程序方式终止一项工作，与 -9 是不一样的
```
- killAll：删除某个服务，基本同 pkill

```
<!--将系统中以某个命令名称启动的进程全部删除-->
killAll -signal 命令名称
```
- nohup 脱机管理

```
<!--终端机前台中工作-->
nohup [命令与参数]

<!--终端机后台中工作-->
nohup [命令与参数] &
```
### 三、进程管理
- ps 将某个时间点的进程运行情况选取下来

```
<!--查看系统所有的进程数据，以 PID 顺序排列-->
ps aux
-a：显示现行终端机下的所有程序，包括其他用户的程序
-u：显示所有程序，不以终端机区分
-x：以用户为主的格式显示程序状况，通常与 a 参数一起使用，可列出较完整信息

 ps -aux | grep nginx
 <!--各字段意义分别为：进程用户账号、进程标识符PID、使用CPU百分比、物理内存百分比、虚拟内存使用量KB、占用固定内存量KB、哪个终端机运行，与终端机无关则显示？、进程目前状态、进程被触发启动时间、使用CPU运行时间、进程实际命令-->
 nginx     2778  0.0  0.4  50208  4196 ?        S    Oct15   0:10 nginx: worker process
```
- pstree 查看进程树

```
<!--显示所有信息-->
pstree -ap
-a：各进程树之间的连接以 ASCII 字符来连接
-p：列出每个进行的PID

pstree | grep httpd
pstree -ap | grep httpd
```
- top 动态查看进程的变化

```
<!--相对于 ps 选取一个时间点的进程状态，top 可以持续监测进程运行的状态-->
top [-d 数字] | [-p pid]
-d：后面可以接秒数，就是进程界面更新的秒数，默认是5秒
-p：指定某个PID来进行查看检测

<!--第一行依次对应:系统当前时间 up 系统到目前为止 i 运行的时间， 当前登陆系统的用户数量， load average 后 面的三个数字分别表示距离现在一分钟，五分钟，十五分钟的负载情况-->
<!--这三个负载即分别表示系统在过去1分钟、5分钟、15分钟内运行进程队列中的平均进程数量-->
top - 14:29:34 up 372 days,  3:54,  1 user,  load average: 0.04, 0.07, 0.06

<!--第二行依次对应:tasks 表示任务(进程)，78 total 则表示现在有 78 个进程，其中处于运行中 的有 1 个，77 个在休眠(挂起)，stopped 状态即停止的进程数为 0，zombie 状态即僵尸 的进程数为 0 个。-->
Tasks:  78 total,   1 running,  77 sleeping,   0 stopped,   0 zombie

<!--第三行只看空闲就可以了:cpu 空闲率为 99.0%-->
%Cpu(s):  0.7 us,  0.3 sy,  0.0 ni, 99.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st

<!--第四行依次对应：总内存:0.969g 空闲:82348/1024/1024=0.0785g，已经使用0.5g，缓存区0.39g-->
<!--缓冲区是从主内存中特地预留出的内存，用来存放特定的一些信息，例如从磁盘中取得的文件表，程序正在读取的内容等等-->
KiB Mem :  1016380 total,    82348 free,   523948 used,   410084 buff/cache

<!--第七行依次对应：进程 id、进程所有者、进程优先级、nice 值，负值表示高优先级，正值表示低优先级、进程使用的虚拟内存总量，单位 kb，VIRT=SWAP+RES、进程使用的、未被换出的物理内存大小，单位 kb，RES=CODE+DATA、共享内存大小，单位 kb、进程状态，D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程、上次更新到现在的 CPU 时间占用百分比、进程使用的物理内存百分比、进程使用的 CPU 时间总计，单位 1/100 秒、进程名称(命令名/命令行)-->
PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND 
```
### 四、查看系统资源
- free 查看内存使用情况

```
<!--显示目前系统的内存总量-->
free [-b|-k|-m|-g]

free -m
              total        used        free      shared  buff/cache   available
Mem:            992         509          86           0         396         292
Swap:             0           0           0
total 系统总的可用物理内存大小
used 已被使用的物理内存大小
free 还有多少物理内存可用
shared 被共享使用的物理内存大小
buff/cache 被 buffer 和 cache 使用的物理内存大小
available 还可以被"应用程序"使用的物理内存大小，程序认为的
系统很有效率地将所有内存用光，目的是为了让系统的访问性能加速
```
- netstat 跟踪网络

```
<!--常用在网络监控-->
netstat -tunpl | grep httpd
-a：将目前系统上所有的连接、监听、Socket 数据都列出来
-t：显示 TCP 传输协议的连线状况
-u：显示 UDP 传输协议的连线状况
-n：直接使用 IP 地址，而不通过域名服务器
-p：显示正在使用 Socket 的程序识别码和程序名称
-l：显示监控中的服务器的 Socket
```
