<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>vuex 之模块初始化 | 青松的博客 | 天行健，君子以自强不息；地势坤，君子以厚德载物。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="现在我们来看下 vuex 的模块初始化。">
<meta name="keywords" content="分享、总结">
<meta property="og:type" content="article">
<meta property="og:title" content="vuex 之模块初始化">
<meta property="og:url" content="http://blog.master-ss.cn/source/vuex/vuex-module-install/index.html">
<meta property="og:site_name" content="青松的博客">
<meta property="og:description" content="现在我们来看下 vuex 的模块初始化。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-08-06T07:21:27.579Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vuex 之模块初始化">
<meta name="twitter:description" content="现在我们来看下 vuex 的模块初始化。">
    
        <link rel="alternate" type="application/atom+xml" title="青松的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.png)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">张松松</h5>
          <a href="mailto:1733458402@qq.com" title="1733458402@qq.com" class="mail">1733458402@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives">
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/node">
                <i class="icon icon-lg icon-bandcamp"></i>
                Node
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/source">
                <i class="icon icon-lg icon-anchor"></i>
                Source
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zss007" target="_blank">
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">vuex 之模块初始化</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">vuex 之模块初始化</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-09-30T06:58:43.000Z" itemprop="datePublished" class="page-time">
  2018-09-30
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/source/">source</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一、installModule"><span class="post-toc-text">一、installModule()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#二、makeLocalContext"><span class="post-toc-text">二、makeLocalContext()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#三、module-forEach"><span class="post-toc-text">三、module.forEach***</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#四、registerMutation"><span class="post-toc-text">四、registerMutation()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#五、registerAction"><span class="post-toc-text">五、registerAction()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#六、registerGetter"><span class="post-toc-text">六、registerGetter()</span></a></li></ol>
        </nav>
    </aside>


<article id="post-source/vuex/vuex-module-install" class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">vuex 之模块初始化</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-09-30 14:58:43" datetime="2018-09-30T06:58:43.000Z" itemprop="datePublished">2018-09-30</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/source/">source</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none">
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>现在我们来看下 vuex 的模块初始化。<br><a id="more"></a></p>
<h3 id="一、installModule"><a href="#一、installModule" class="headerlink" title="一、installModule()"></a>一、installModule()</h3><p>我们接着来看 ‘src/store.js’ 中的构造器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export class Store &#123;</span><br><span class="line">  constructor (options = &#123;&#125;) &#123;</span><br><span class="line">    const state = this._modules.root.state</span><br><span class="line"></span><br><span class="line">    // init root module. 初始化根模块</span><br><span class="line">    // this also recursively registers all sub-modules 并递归注册所有子模块</span><br><span class="line">    // and collects all module getters inside this._wrappedGetters</span><br><span class="line">    installModule(this, state, [], this._modules.root)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>经过上节的分析，我们知道 this._modules.root 为根模块，因此从根模块上获取 state 属性。然后执行的是 installModule：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 对模块中的 state、getters、mutations、actions 做初始化工作</span><br><span class="line">// store 表示 root store；state 表示 root state；path 表示模块的访问路径；module 表示当前的模块；hot 表示是否是热更新</span><br><span class="line">function installModule (store, rootState, path, module, hot) &#123;</span><br><span class="line">  // 判断是否是根模块</span><br><span class="line">  const isRoot = !path.length</span><br><span class="line">  // 获取 path 路径下的命名空间</span><br><span class="line">  const namespace = store._modules.getNamespace(path)</span><br><span class="line"></span><br><span class="line">  // register in namespace map（把 namespace 对应的模块保存下来，为了方便以后能根据 namespace 查找模块）</span><br><span class="line">  if (module.namespaced) &#123;</span><br><span class="line">    store._modulesNamespaceMap[namespace] = module</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // state 初始化</span><br><span class="line">  if (!isRoot &amp;&amp; !hot) &#123;</span><br><span class="line">    const parentState = getNestedState(rootState, path.slice(0, -1))</span><br><span class="line">    const moduleName = path[path.length - 1]</span><br><span class="line">    store._withCommit(() =&gt; &#123;</span><br><span class="line">      Vue.set(parentState, moduleName, module.state)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const local = module.context = makeLocalContext(store, namespace, path)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们一步步来分析下，先看 getNamespace 方法实现，见 ‘src/module/module-collection.js’ 中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 获取相应路径下模块的命名空间（从 root module 开始，通过 reduce 方法一层层找子模块，如果发现该模块配置了 namespaced 为 true，则把该模块的 key 拼到 namesapce 中，最终返回完整的 namespace 字符串）</span><br><span class="line">getNamespace (path) &#123;</span><br><span class="line">  let module = this.root</span><br><span class="line">  return path.reduce((namespace, key) =&gt; &#123;</span><br><span class="line">    module = module.getChild(key)</span><br><span class="line">    return namespace + (module.namespaced ? key + &apos;/&apos; : &apos;&apos;)</span><br><span class="line">  &#125;, &apos;&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>this.root 表示根模块，namespaced 实现见 ‘src/module/module.js’ 中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 该模块是否带有命名空间</span><br><span class="line">get namespaced () &#123;</span><br><span class="line">  return !!this._rawModule.namespaced</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>getChild 实现见 ‘src/module/module.js’ 中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 获取相应 key 的子模块</span><br><span class="line">getChild (key) &#123;</span><br><span class="line">  return this._children[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>即如果 vuex 的子模块配置中出现了 namespaced，那么 module.namespaced 返回 true。然后我们使用 _modulesNamespaceMap 存储命名空间的模块，以便后续可根据 namespace 查找模块。</p>
<h3 id="二、makeLocalContext"><a href="#二、makeLocalContext" class="headerlink" title="二、makeLocalContext()"></a>二、makeLocalContext()</h3><p>我们接着来看 installModule 中的 makeLocalContext：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * make localized dispatch, commit, getters and state</span><br><span class="line"> * if there is no namespace, just use root ones</span><br><span class="line"> * store 表示 root store；namespace 表示模块的命名空间，path 表示模块的 path</span><br><span class="line"> */</span><br><span class="line">function makeLocalContext (store, namespace, path) &#123;</span><br><span class="line">  const noNamespace = namespace === &apos;&apos;</span><br><span class="line"></span><br><span class="line">  // 如果没有命名空间，则使用 root store 的 dispatch 和 commit 方法，options 为 &#123; root: true &#125; 时，在全局命名空间内分发 action 或提交 mutation</span><br><span class="line">  const local = &#123;</span><br><span class="line">    dispatch: noNamespace ? store.dispatch : (_type, _payload, _options) =&gt; &#123;</span><br><span class="line">      const args = unifyObjectStyle(_type, _payload, _options)</span><br><span class="line">      const &#123; payload, options &#125; = args</span><br><span class="line">      let &#123; type &#125; = args</span><br><span class="line"></span><br><span class="line">      if (!options || !options.root) &#123;</span><br><span class="line">        // 把 type 自动拼接上 namespace</span><br><span class="line">        type = namespace + type</span><br><span class="line">        // 非生产环境下给出提示信息</span><br><span class="line">        if (process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; !store._actions[type]) &#123;</span><br><span class="line">          console.error(`[vuex] unknown local action type: $&#123;args.type&#125;, global type: $&#123;type&#125;`)</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return store.dispatch(type, payload)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    commit: noNamespace ? store.commit : (_type, _payload, _options) =&gt; &#123;</span><br><span class="line">      const args = unifyObjectStyle(_type, _payload, _options)</span><br><span class="line">      const &#123; payload, options &#125; = args</span><br><span class="line">      let &#123; type &#125; = args</span><br><span class="line">      </span><br><span class="line">      if (!options || !options.root) &#123;</span><br><span class="line">        // 把 type 自动拼接上 namespace</span><br><span class="line">        type = namespace + type</span><br><span class="line">        // 非生产环境下给出提示信息</span><br><span class="line">        if (process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; !store._mutations[type]) &#123;</span><br><span class="line">          console.error(`[vuex] unknown local mutation type: $&#123;args.type&#125;, global type: $&#123;type&#125;`)</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      store.commit(type, payload, options)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // getters and state object must be gotten lazily</span><br><span class="line">  // because they will be changed by vm update</span><br><span class="line">  Object.defineProperties(local, &#123;</span><br><span class="line">    getters: &#123;</span><br><span class="line">      get: noNamespace</span><br><span class="line">        ? () =&gt; store.getters</span><br><span class="line">        : () =&gt; makeLocalGetters(store, namespace)</span><br><span class="line">    &#125;,</span><br><span class="line">    state: &#123;</span><br><span class="line">      get: () =&gt; getNestedState(store.state, path)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  return local</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到我们主要是为 local 对象的 getters 和 state 属性定义 getter 拦截器。然后让我们继续往下看，然后再回过头来分析这段代码。</p>
<h3 id="三、module-forEach"><a href="#三、module-forEach" class="headerlink" title="三、module.forEach***"></a>三、module.forEach***</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// 遍历模块下的 mutations，并注册</span><br><span class="line">module.forEachMutation((mutation, key) =&gt; &#123;</span><br><span class="line">  const namespacedType = namespace + key</span><br><span class="line">  registerMutation(store, namespacedType, mutation, local)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 遍历模块下的 actions，并注册</span><br><span class="line">module.forEachAction((action, key) =&gt; &#123;</span><br><span class="line">  // root 为 true 时，表示在带命名空间的模块注册全局 action</span><br><span class="line">  const type = action.root ? key : namespace + key</span><br><span class="line">  const handler = action.handler || action</span><br><span class="line">  registerAction(store, type, handler, local)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 遍历模块下的 getters，并注册</span><br><span class="line">module.forEachGetter((getter, key) =&gt; &#123;</span><br><span class="line">  const namespacedType = namespace + key</span><br><span class="line">  registerGetter(store, namespacedType, getter, local)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 遍历模块中的所有子 modules，递归执行 installModule 方法</span><br><span class="line">module.forEachChild((child, key) =&gt; &#123;</span><br><span class="line">  installModule(store, rootState, path.concat(key), child, hot)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>可以看到我们调用了 module 的 forEachMutation、forEachAction、forEachGetter、forEachChild 方法，其具体实现代码见 ‘src/module/module.js’ 中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 遍历子模块，将键值对传入 fn</span><br><span class="line">forEachChild (fn) &#123;</span><br><span class="line">  forEachValue(this._children, fn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 遍历当前模块 getters，将键值对传入 fn</span><br><span class="line">forEachGetter (fn) &#123;</span><br><span class="line">  if (this._rawModule.getters) &#123;</span><br><span class="line">    forEachValue(this._rawModule.getters, fn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 遍历当前模块 actions，将键值对传入 fn</span><br><span class="line">forEachAction (fn) &#123;</span><br><span class="line">  if (this._rawModule.actions) &#123;</span><br><span class="line">    forEachValue(this._rawModule.actions, fn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 遍历当前模块 mutations，将键值对传入 fn</span><br><span class="line">forEachMutation (fn) &#123;</span><br><span class="line">  if (this._rawModule.mutations) &#123;</span><br><span class="line">    forEachValue(this._rawModule.mutations, fn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到我们分别遍历当前模块下的 mutations、actions、getters、modules 并注册，然后递归调用 installModule 方法遍历当前模块的子模块。</p>
<h3 id="四、registerMutation"><a href="#四、registerMutation" class="headerlink" title="四、registerMutation()"></a>四、registerMutation()</h3><p>我们继续回到 installModule 方法中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 遍历模块下的 mutations，并注册</span><br><span class="line">module.forEachMutation((mutation, key) =&gt; &#123;</span><br><span class="line">  const namespacedType = namespace + key</span><br><span class="line">  registerMutation(store, namespacedType, mutation, local)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>首先使用当前模块的命名空间 namespace 和模块名 key 拼接，然后调用 registerMutation 方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 给 root store 上的 _mutations[types] 添加 wrappedMutationHandler 方法（注意，同一 type 的 _mutations 可以对应多个方法）</span><br><span class="line">function registerMutation (store, type, handler, local) &#123;</span><br><span class="line">  const entry = store._mutations[type] || (store._mutations[type] = [])</span><br><span class="line">  entry.push(function wrappedMutationHandler (payload) &#123;</span><br><span class="line">    handler.call(store, local.state, payload)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>首先获取或初始化 _mutations 相应命名空间下数组，然后我们在 _mutations 中添加 wrappedMutationHandler 方法。注意 handle 即配置中的 mutations 方法，this 绑定为 root store，payload 为载荷，然后我们回到 makeLocalContext 中查看 local.state 拿到的数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Object.defineProperties(local, &#123;</span><br><span class="line">    ...</span><br><span class="line">    state: &#123;</span><br><span class="line">      get: () =&gt; getNestedState(store.state, path)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure></p>
<p>getNestedState 的实现如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 从 root state 开始，通过 path.reduce 方法一层层查找子模块 state，最终找到目标模块的 state</span><br><span class="line">function getNestedState (state, path) &#123;</span><br><span class="line">  return path.length</span><br><span class="line">    ? path.reduce((state, key) =&gt; state[key], state)</span><br><span class="line">    : state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>看到这里，我们应该理解原来 local.state 获取的就是当前模块的 state。不过还有个问题，就是 state[key] 为什么就是相应 key 子模块的 state，这时候我们就要回到 installModule 方法看这段代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// state 初始化</span><br><span class="line">if (!isRoot &amp;&amp; !hot) &#123;</span><br><span class="line">  const parentState = getNestedState(rootState, path.slice(0, -1))</span><br><span class="line">  const moduleName = path[path.length - 1]</span><br><span class="line">  store._withCommit(() =&gt; &#123;</span><br><span class="line">    Vue.set(parentState, moduleName, module.state)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们可以看到如果不是根模块而且不是热更新，那么我们先拿到父模块的 state，然后获取当前模块名，最后调用 _withCommit 方法，并在方法参数内调用 Vue.set 为父模块 state 访问子模块建立联系，即 <code>parentState[moduleName] = module.state</code>。然后我们来看下 _withCommit 方法的实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 内置提交修改 state，防止被捕获</span><br><span class="line">_withCommit (fn) &#123;</span><br><span class="line">  const committing = this._committing</span><br><span class="line">  this._committing = true</span><br><span class="line">  fn()</span><br><span class="line">  this._committing = committing</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们之所以要这么做是因为要保证对 Vuex 中 state 的修改只能在 mutation 的回调函数中。</p>
<h3 id="五、registerAction"><a href="#五、registerAction" class="headerlink" title="五、registerAction()"></a>五、registerAction()</h3><p>我们继续回到 installModule 方法中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 遍历模块下的 actions，并注册</span><br><span class="line">module.forEachAction((action, key) =&gt; &#123;</span><br><span class="line">  // root 为 true 时，表示在带命名空间的模块注册全局 action</span><br><span class="line">  const type = action.root ? key : namespace + key</span><br><span class="line">  const handler = action.handler || action</span><br><span class="line">  registerAction(store, type, handler, local)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>注意在 vuex 配置中，action 可设置 root 为 true，表示在带命名空间的模块注册全局 action，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  modules: &#123;</span><br><span class="line">    foo: &#123;</span><br><span class="line">      namespaced: true,</span><br><span class="line"></span><br><span class="line">      actions: &#123;</span><br><span class="line">        someAction: &#123;</span><br><span class="line">          root: true,</span><br><span class="line">          handler (namespacedContext, payload) &#123; ... &#125; // -&gt; &apos;someAction&apos;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>而 <code>action.handler || action</code> 为 action 的两种配置格式，我们接着看 registerAction：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 给 root store 上的 _actions[types] 添加 wrappedActionHandler 方法</span><br><span class="line">function registerAction (store, type, handler, local) &#123;</span><br><span class="line">  const entry = store._actions[type] || (store._actions[type] = [])</span><br><span class="line">  entry.push(function wrappedActionHandler (payload, cb) &#123;</span><br><span class="line">    let res = handler.call(store, &#123;</span><br><span class="line">      dispatch: local.dispatch,</span><br><span class="line">      commit: local.commit,</span><br><span class="line">      getters: local.getters,</span><br><span class="line">      state: local.state,</span><br><span class="line">      rootGetters: store.getters,</span><br><span class="line">      rootState: store.state</span><br><span class="line">    &#125;, payload, cb)</span><br><span class="line">    if (!isPromise(res)) &#123;</span><br><span class="line">      res = Promise.resolve(res)</span><br><span class="line">    &#125;</span><br><span class="line">    if (store._devtoolHook) &#123;</span><br><span class="line">      return res.catch(err =&gt; &#123;</span><br><span class="line">        store._devtoolHook.emit(&apos;vuex:error&apos;, err)</span><br><span class="line">        throw err</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return res</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>首先获取或初始化 _actions 对应命名空间下的数组，然后添加 wrappedActionHandler 方法。可以看到我们 action 调用时，this 绑定为 root store，context 对象存在 dispatch、commit、getters、state、rootGetters 和 rootState 属性，并且将 action 执行返回结果处理为 Promise 对象。<br>我们刚才已经讲过 local.state，现在我们来看下 local.dispatch、local.commit 和 local.getters：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">// 如果没有命名空间，则使用 root store 的 dispatch 和 commit 方法，options 为 &#123; root: true &#125; 时，在全局命名空间内分发 action 或提交 mutation</span><br><span class="line">const local = &#123;</span><br><span class="line">  dispatch: noNamespace ? store.dispatch : (_type, _payload, _options) =&gt; &#123;</span><br><span class="line">    const args = unifyObjectStyle(_type, _payload, _options)</span><br><span class="line">    const &#123; payload, options &#125; = args</span><br><span class="line">    let &#123; type &#125; = args</span><br><span class="line"></span><br><span class="line">    if (!options || !options.root) &#123;</span><br><span class="line">      // 把 type 自动拼接上 namespace</span><br><span class="line">      type = namespace + type</span><br><span class="line">      // 非生产环境下给出提示信息</span><br><span class="line">      if (process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; !store._actions[type]) &#123;</span><br><span class="line">        console.error(`[vuex] unknown local action type: $&#123;args.type&#125;, global type: $&#123;type&#125;`)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return store.dispatch(type, payload)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  commit: noNamespace ? store.commit : (_type, _payload, _options) =&gt; &#123;</span><br><span class="line">    const args = unifyObjectStyle(_type, _payload, _options)</span><br><span class="line">    const &#123; payload, options &#125; = args</span><br><span class="line">    let &#123; type &#125; = args</span><br><span class="line">    </span><br><span class="line">    if (!options || !options.root) &#123;</span><br><span class="line">      // 把 type 自动拼接上 namespace</span><br><span class="line">      type = namespace + type</span><br><span class="line">      // 非生产环境下给出提示信息</span><br><span class="line">      if (process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; !store._mutations[type]) &#123;</span><br><span class="line">        console.error(`[vuex] unknown local mutation type: $&#123;args.type&#125;, global type: $&#123;type&#125;`)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    store.commit(type, payload, options)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// getters and state object must be gotten lazily</span><br><span class="line">// because they will be changed by vm update</span><br><span class="line">Object.defineProperties(local, &#123;</span><br><span class="line">  getters: &#123;</span><br><span class="line">    get: noNamespace</span><br><span class="line">      ? () =&gt; store.getters</span><br><span class="line">      : () =&gt; makeLocalGetters(store, namespace)</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>先看 local.getters，我们注意到，如果没有命名空间，那么返回 root store 的 getters，否则执行 makeLocalGetters：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// 获取子模块的 getters</span><br><span class="line">function makeLocalGetters (store, namespace) &#123;</span><br><span class="line">  const gettersProxy = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  const splitPos = namespace.length</span><br><span class="line">  // 遍历 root store 下的所有 getters</span><br><span class="line">  Object.keys(store.getters).forEach(type =&gt; &#123;</span><br><span class="line">    // skip if the target getter is not match this namespace（判断是否匹配命名空间）</span><br><span class="line">    if (type.slice(0, splitPos) !== namespace) return</span><br><span class="line"></span><br><span class="line">    // extract local getter type（只有匹配的时候从 namespace 的位置截取后面的字符串得到 localType）</span><br><span class="line">    const localType = type.slice(splitPos)</span><br><span class="line"></span><br><span class="line">    // Add a port to the getters proxy.</span><br><span class="line">    // Define as getter property because</span><br><span class="line">    // we do not want to evaluate the getters in this time.</span><br><span class="line">    Object.defineProperty(gettersProxy, localType, &#123;</span><br><span class="line">      get: () =&gt; store.getters[type],</span><br><span class="line">      enumerable: true</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  return gettersProxy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>再来看下 local.dispatch，如果没有命名空间，则使用 root store 的 dispatch 方法，否则调用封装方法。首先我们来看 unifyObjectStyle 方法实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 统一对象风格 store.commit(&#123; type: &apos;increment&apos;, amount: 10 &#125;) | store.commit(&apos;increment&apos;, &#123; amount: 10 &#125;)</span><br><span class="line">function unifyObjectStyle (type, payload, options) &#123;</span><br><span class="line">  if (isObject(type) &amp;&amp; type.type) &#123;</span><br><span class="line">    options = payload</span><br><span class="line">    payload = type</span><br><span class="line">    type = type.type</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 非生产环境下给出提示信息</span><br><span class="line">  if (process.env.NODE_ENV !== &apos;production&apos;) &#123;</span><br><span class="line">    assert(typeof type === &apos;string&apos;, `expects string as the type, but found $&#123;typeof type&#125;.`)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &#123; type, payload, options &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到 unifyObjectStyle 是用来统一对象风格的。然后继续看 local.dispatch 方法，我们判断 options 是否存在而且 root 属性是否为 true。如果 if 语句执行失败，则直接调用 root store 的 dispatch 方法，否则我们为 type 拼接上命名空间，然后调用 dispatch 方法。local.commit 基本同 local.dispatch，我们就不讨论了。最后我们来看这段代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (store._devtoolHook) &#123;</span><br><span class="line">    return res.catch(err =&gt; &#123;</span><br><span class="line">        store._devtoolHook.emit(&apos;vuex:error&apos;, err)</span><br><span class="line">        throw err</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果 store 存在 _devtoolHook，即我们使用 devtool 插件时，我们为 Promise 对象 res 添加 catch 方法捕获错误。</p>
<h3 id="六、registerGetter"><a href="#六、registerGetter" class="headerlink" title="六、registerGetter()"></a>六、registerGetter()</h3><p>我们现在回到 installModule 方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 遍历模块下的 getters，并注册</span><br><span class="line">module.forEachGetter((getter, key) =&gt; &#123;</span><br><span class="line">  const namespacedType = namespace + key</span><br><span class="line">  registerGetter(store, namespacedType, getter, local)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>我们首先拼接出命名空间路径，然后调用 registerGetter 方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// root store 上的 _wrappedGetters[key] 指定 wrappedGetter 方法</span><br><span class="line">function registerGetter (store, type, rawGetter, local) &#123;</span><br><span class="line">  // 注意，同一 type 的 _wrappedGetters 只能定义一个，非生产环境下给出提示信息</span><br><span class="line">  if (store._wrappedGetters[type]) &#123;</span><br><span class="line">    if (process.env.NODE_ENV !== &apos;production&apos;) &#123;</span><br><span class="line">      console.error(`[vuex] duplicate getter key: $&#123;type&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  store._wrappedGetters[type] = function wrappedGetter (store) &#123;</span><br><span class="line">    return rawGetter(</span><br><span class="line">      local.state, // local state</span><br><span class="line">      local.getters, // local getters</span><br><span class="line">      store.state, // root state</span><br><span class="line">      store.getters // root getters</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们判断在 _wrappedGetters 是否已经存在相应命名空间路径的 getter，如果存在直接返回并给出提示，即同一 type 的 _wrappedGetters 只能定义一个。如果并未定义，我们将 wrappedGetter 赋值给 store._wrappedGetters[type]。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-08-06T07:21:27.579Z" itemprop="dateUpdated">2019-08-06 15:21:27</time>
</span><br>


        
        本文地址：<a href="/source/vuex/vuex-module-install/" target="_blank" rel="external">http://blog.master-ss.cn/source/vuex/vuex-module-install/</a>
        
    </div>
    
    <footer>
        <a href="http://blog.master-ss.cn">
            <img src="/img/avatar.png" alt="张松松">
            张松松
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.master-ss.cn/source/vuex/vuex-module-install/&title=《vuex 之模块初始化》 — 青松的博客&pic=http://blog.master-ss.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.master-ss.cn/source/vuex/vuex-module-install/&title=《vuex 之模块初始化》 — 青松的博客&source=现在我们来看下 vuex 的模块初始化。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.master-ss.cn/source/vuex/vuex-module-install/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《vuex 之模块初始化》 — 青松的博客&url=http://blog.master-ss.cn/source/vuex/vuex-module-install/&via=http://blog.master-ss.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.master-ss.cn/source/vuex/vuex-module-install/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/source/vuex/vuex-vm/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">vuex 之初始化 store._vm</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/source/vuex/vuex-module-register/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">vuex 之模块注册</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "wUJ09egw1xIlxVQMQzLGKT4M-gzGzoHsz",
            appKey: "2Vk9VCblILWnai3FCQ0iQogY",
            avatar: "mm",
            placeholder: "写点什么？",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->







</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>张松松 &copy; 2016 - 2019</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">赣ICP备18001386号-1</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.master-ss.cn/source/vuex/vuex-module-install/&title=《vuex 之模块初始化》 — 青松的博客&pic=http://blog.master-ss.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.master-ss.cn/source/vuex/vuex-module-install/&title=《vuex 之模块初始化》 — 青松的博客&source=现在我们来看下 vuex 的模块初始化。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.master-ss.cn/source/vuex/vuex-module-install/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《vuex 之模块初始化》 — 青松的博客&url=http://blog.master-ss.cn/source/vuex/vuex-module-install/&via=http://blog.master-ss.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.master-ss.cn/source/vuex/vuex-module-install/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACIElEQVR42u3aS27EIBAFwNz/0hMpq2xgXnc7H+NiZSHZUBnpBWg+PuL2+mqr5+89Sf/q+6u3LmsYGBi3Zby2bTX8fsjka6ueff9yXAwMjAcwJiG7D9ZqQO+/vOzHwMDAaAVob6IYGBgYVwVuvgXNe/7g/wYGBsatGPNIvSpqf3wvjoGBcUPGvDDwc8+/Wt/AwMD4l4xXq+Xg+RIzmg8GBsbRjKQYWU283gFc/s3CJDAwMA5i9CaX4HsFy0m4Y2BgnMqoHuUnQXlVuBdCFgMD41BG75g+eU7eza/MvlkmYmBgPJKRRHBOrS4xyyVMDAyMoxnJ4q96JeJaQPmoDgMD4zhG9cJWdRNbjWkMDAyMFaM3lV74Vi9VNEsCGBgYxzF6Jcn9wnF+FSOfAwYGxtmMSaTOF5GT8kO52omBgXFzRq8AcNWEqsvK0S+DgYFxc0b1mlfev18sVgO6UN/AwMA4iJGEWr7Rzac+KXMufwcMDIwHMHrD9MqcyR+uGbgYGBiHMibHcFeVJ0fFAwwMjAcwJkfzvetc883tm00sBgbGQYy8GJkvAavv9o7YMDAwnsB4FVsvRqtHeNVxMTAwzmbk7apiQO9iGQYGBkYvZKtb02p5YHTchoGBcSijeoiWH8P1ypw5GwMDA6M3fK+c0NvKYmBgYEyWj9ULZIWFIAYGxiMZyRSTaxB7zLwHAwPjmYxqKCfBWp1oUh7Yfx8DA+NQxid8tkHPI/bQ/wAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
