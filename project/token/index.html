<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>blockchain 之 eth 发币、映射、钱包 | 青松的博客 | 天行健，君子以自强不息；地势坤，君子以厚德载物。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="这章介绍以太坊发币，映射 eos 公链和钱包开发价值。">
<meta name="keywords" content="分享、总结">
<meta property="og:type" content="article">
<meta property="og:title" content="blockchain 之 eth 发币、映射、钱包">
<meta property="og:url" content="http://blog.master-ss.cn/project/token/index.html">
<meta property="og:site_name" content="青松的博客">
<meta property="og:description" content="这章介绍以太坊发币，映射 eos 公链和钱包开发价值。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-09-29T09:13:45.864Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="blockchain 之 eth 发币、映射、钱包">
<meta name="twitter:description" content="这章介绍以太坊发币，映射 eos 公链和钱包开发价值。">
    
        <link rel="alternate" type="application/atom+xml" title="青松的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.png)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">张松松</h5>
          <a href="mailto:1733458402@qq.com" title="1733458402@qq.com" class="mail">1733458402@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives">
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/node">
                <i class="icon icon-lg icon-bandcamp"></i>
                Node
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/source">
                <i class="icon icon-lg icon-anchor"></i>
                Source
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/project">
                <i class="icon icon-lg icon-product-hunt"></i>
                Project
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zss007" target="_blank">
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">blockchain 之 eth 发币、映射、钱包</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">blockchain 之 eth 发币、映射、钱包</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-09-26T14:58:55.000Z" itemprop="datePublished" class="page-time">
  2018-09-26
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/project/">project</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一、发币"><span class="post-toc-text">一、发币</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-1、简介"><span class="post-toc-text">1.1、简介</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-2、ERC20-内容"><span class="post-toc-text">1.2、ERC20 内容</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-3、ERC20-实现案例"><span class="post-toc-text">1.3、ERC20 实现案例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-4、自定义合约"><span class="post-toc-text">1.4、自定义合约</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#二、映射"><span class="post-toc-text">二、映射</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1、映射教程（https-www-zhihu-com-question-265707806-）"><span class="post-toc-text">2.1、映射教程（https://www.zhihu.com/question/265707806 ）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2-1-1、到EOS公链上生成EOS密钥对"><span class="post-toc-text">2.1.1、到EOS公链上生成EOS密钥对</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2-1-2、注册一个-myetherwallet-的钱包，并进行映射"><span class="post-toc-text">2.1.2、注册一个 myetherwallet 的钱包，并进行映射</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2、映射部分代码"><span class="post-toc-text">2.2、映射部分代码</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#三、钱包"><span class="post-toc-text">三、钱包</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1、钱包简介"><span class="post-toc-text">3.1、钱包简介</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2、钱包之应用分发中心"><span class="post-toc-text">3.2、钱包之应用分发中心</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3、钱包拓展背景"><span class="post-toc-text">3.3、钱包拓展背景</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-4、DAPP-的价值"><span class="post-toc-text">3.4、DAPP 的价值</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-5、多链资产和跨链交易"><span class="post-toc-text">3.5、多链资产和跨链交易</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-project/token" class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">blockchain 之 eth 发币、映射、钱包</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-09-26 22:58:55" datetime="2018-09-26T14:58:55.000Z" itemprop="datePublished">2018-09-26</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/project/">project</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none">
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>这章介绍以太坊发币，映射 eos 公链和钱包开发价值。<br><a id="more"></a></p>
<h3 id="一、发币"><a href="#一、发币" class="headerlink" title="一、发币"></a>一、发币</h3><h4 id="1-1、简介"><a href="#1-1、简介" class="headerlink" title="1.1、简介"></a>1.1、简介</h4><p>ERC20 是以太坊代币的标准，以太坊 token （即代币）就是基于 ERC20 标准的数字货币，token 兼容以太坊钱包。<br>通俗上我们可以把以太坊当成一条大街，然后街上有很多店。为了经营，每个店都发布了自己的会员卡，这个会员卡就是 token。</p>
<h4 id="1-2、ERC20-内容"><a href="#1-2、ERC20-内容" class="headerlink" title="1.2、ERC20 内容"></a>1.2、ERC20 内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 返回 string 类型的 ERC20 代币的名字</span><br><span class="line">name</span><br><span class="line">// 返回 string 类型的 ERC20 代币的符号，也就是代币的简称</span><br><span class="line">symbol</span><br><span class="line">// 支持几位小数点后几位，如果设置为 3，也就是支持 0.001 表示</span><br><span class="line">decimals</span><br><span class="line">// 发行代币的总量</span><br><span class="line">totalSupply</span><br><span class="line">// 获取该地址代币的余额</span><br><span class="line">balanceOf</span><br><span class="line">// 调用 transfer 函数将 token 转账给 _to 地址，_value 为转账个数</span><br><span class="line">transfer</span><br><span class="line">// 批准账户从自己的账户转移 _value 个 token，可以分多次转移</span><br><span class="line">approve</span><br><span class="line">// 与 approve 搭配使用，approve 批准之后，调用 transferFrom 函数来转移 token</span><br><span class="line">transferForm</span><br><span class="line">// 返回其他账户还能提取 token 的个数</span><br><span class="line">allowance</span><br><span class="line">// 当成功转移 token 时，一定要触发 Transfer 事件</span><br><span class="line">Transfer</span><br><span class="line">// 当调用 approval 函数成功时，一定要触发 Approval 事件</span><br><span class="line">Approval</span><br></pre></td></tr></table></figure>
<h4 id="1-3、ERC20-实现案例"><a href="#1-3、ERC20-实现案例" class="headerlink" title="1.3、ERC20 实现案例"></a>1.3、ERC20 实现案例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.16;</span><br><span class="line"></span><br><span class="line">contract TokenERC20 &#123;</span><br><span class="line">    // token 的共有变量</span><br><span class="line">    string public name;</span><br><span class="line">    string public symbol;</span><br><span class="line">    // 强烈建议使用 18 位小数</span><br><span class="line">    uint8 public decimals = 18;</span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line"></span><br><span class="line">    // 创建一个地址的余额映射</span><br><span class="line">    mapping (address =&gt; uint256) public balanceOf;</span><br><span class="line">    // 创建一个地址的授权映射</span><br><span class="line">    mapping (address =&gt; mapping (address =&gt; uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    // 生成一个公共事件用来提醒客户端</span><br><span class="line">    event Transfer(address indexed from, address indexed to, uint256 value);</span><br><span class="line"></span><br><span class="line">    // 提醒客户端销毁多少token</span><br><span class="line">    event Burn(address indexed from, uint256 value);</span><br><span class="line"></span><br><span class="line">    // 构造函数</span><br><span class="line">    function TokenERC20(</span><br><span class="line">        uint256 initialSupply,</span><br><span class="line">        string tokenName,</span><br><span class="line">        string tokenSymbol</span><br><span class="line">    ) public &#123;</span><br><span class="line">        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount</span><br><span class="line">        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial tokens</span><br><span class="line">        name = tokenName;                                   // Set the name for display purposes</span><br><span class="line">        symbol = tokenSymbol;                               // Set the symbol for display purposes</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 内部转换，只能被合约内容调用</span><br><span class="line">    function _transfer(address _from, address _to, uint _value) internal &#123;</span><br><span class="line">        // Prevent transfer to 0x0 address. Use burn() instead</span><br><span class="line">        require(_to != 0x0);</span><br><span class="line">        // Check if the sender has enough</span><br><span class="line">        require(balanceOf[_from] &gt;= _value);</span><br><span class="line">        // Check for overflows （检查溢出）</span><br><span class="line">        require(balanceOf[_to] + _value &gt;= balanceOf[_to]);</span><br><span class="line">        // Save this for an assertion in the future</span><br><span class="line">        uint previousBalances = balanceOf[_from] + balanceOf[_to];</span><br><span class="line">        // Subtract from the sender</span><br><span class="line">        balanceOf[_from] -= _value;</span><br><span class="line">        // Add the same to the recipient</span><br><span class="line">        balanceOf[_to] += _value;</span><br><span class="line">        emit Transfer(_from, _to, _value);</span><br><span class="line">        // Asserts are used to use static analysis to find bugs in your code. They should never fail</span><br><span class="line">        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 从账户转移 token 到其他账户</span><br><span class="line">    function transfer(address _to, uint256 _value) public &#123;</span><br><span class="line">        _transfer(msg.sender, _to, _value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 从 _from 转移 token 到 _to 上，代替 _from 账户</span><br><span class="line">    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) &#123;</span><br><span class="line">        require(_value &lt;= allowance[_from][msg.sender]);     // Check allowance</span><br><span class="line">        allowance[_from][msg.sender] -= _value;</span><br><span class="line">        _transfer(_from, _to, _value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 授权 _spender 使用账户 token</span><br><span class="line">    function approve(address _spender, uint256 _value) public</span><br><span class="line">        returns (bool success) &#123;</span><br><span class="line">        allowance[msg.sender][_spender] = _value;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 销毁 token</span><br><span class="line">    function burn(uint256 _value) public returns (bool success) &#123;</span><br><span class="line">        require(balanceOf[msg.sender] &gt;= _value);   // Check if the sender has enough</span><br><span class="line">        balanceOf[msg.sender] -= _value;            // Subtract from the sender</span><br><span class="line">        totalSupply -= _value;                      // Updates totalSupply</span><br><span class="line">        emit Burn(msg.sender, _value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 销毁其他账户的 token</span><br><span class="line">    function burnFrom(address _from, uint256 _value) public returns (bool success) &#123;</span><br><span class="line">        require(balanceOf[_from] &gt;= _value);                // Check if the targeted balance is enough</span><br><span class="line">        require(_value &lt;= allowance[_from][msg.sender]);    // Check allowance</span><br><span class="line">        balanceOf[_from] -= _value;                         // Subtract from the targeted balance</span><br><span class="line">        allowance[_from][msg.sender] -= _value;             // Subtract from the sender&apos;s allowance</span><br><span class="line">        totalSupply -= _value;                              // Update totalSupply</span><br><span class="line">        emit Burn(_from, _value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-4、自定义合约"><a href="#1-4、自定义合约" class="headerlink" title="1.4、自定义合约"></a>1.4、自定义合约</h4><p>虽然我们可以一行代码都不敲，直接粘贴复制合约代码发币，但是往往这样满足不了我们自定义的需求。现在来添加以下自定义功能：权限控制、添加token、资源冻结、交易和购买。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.16;</span><br><span class="line"></span><br><span class="line">// 权限控制</span><br><span class="line">contract owned &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    function owned() public &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner &#123;</span><br><span class="line">        require(msg.sender == owner);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function transferOwnership(address newOwner) onlyOwner public &#123;</span><br><span class="line">        owner = newOwner;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract TokenERC20 &#123;</span><br><span class="line">    // token 的共有变量</span><br><span class="line">    string public name;</span><br><span class="line">    string public symbol;</span><br><span class="line">    // 强烈建议使用 18 位小数</span><br><span class="line">    uint8 public decimals = 18;</span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line"></span><br><span class="line">    // 创建一个地址的余额映射</span><br><span class="line">    mapping (address =&gt; uint256) public balanceOf;</span><br><span class="line">    // 创建一个地址的授权映射</span><br><span class="line">    mapping (address =&gt; mapping (address =&gt; uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    // 生成一个公共事件用来提醒客户端</span><br><span class="line">    event Transfer(address indexed from, address indexed to, uint256 value);</span><br><span class="line"></span><br><span class="line">    // 提醒客户端销毁多少token</span><br><span class="line">    event Burn(address indexed from, uint256 value);</span><br><span class="line"></span><br><span class="line">    // 构造函数</span><br><span class="line">    function TokenERC20(</span><br><span class="line">        uint256 initialSupply,</span><br><span class="line">        string tokenName,</span><br><span class="line">        string tokenSymbol</span><br><span class="line">    ) public &#123;</span><br><span class="line">        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount</span><br><span class="line">        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial tokens</span><br><span class="line">        name = tokenName;                                   // Set the name for display purposes</span><br><span class="line">        symbol = tokenSymbol;                               // Set the symbol for display purposes</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 内部转换，只能被合约内容调用</span><br><span class="line">    function _transfer(address _from, address _to, uint _value) internal &#123;</span><br><span class="line">        // Prevent transfer to 0x0 address. Use burn() instead</span><br><span class="line">        require(_to != 0x0);</span><br><span class="line">        // Check if the sender has enough</span><br><span class="line">        require(balanceOf[_from] &gt;= _value);</span><br><span class="line">        // Check for overflows （检查溢出）</span><br><span class="line">        require(balanceOf[_to] + _value &gt;= balanceOf[_to]);</span><br><span class="line">        // Save this for an assertion in the future</span><br><span class="line">        uint previousBalances = balanceOf[_from] + balanceOf[_to];</span><br><span class="line">        // Subtract from the sender</span><br><span class="line">        balanceOf[_from] -= _value;</span><br><span class="line">        // Add the same to the recipient</span><br><span class="line">        balanceOf[_to] += _value;</span><br><span class="line">        emit Transfer(_from, _to, _value);</span><br><span class="line">        // Asserts are used to use static analysis to find bugs in your code. They should never fail</span><br><span class="line">        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 从账户转移 token 到其他账户</span><br><span class="line">    function transfer(address _to, uint256 _value) public &#123;</span><br><span class="line">        _transfer(msg.sender, _to, _value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 从 _from 转移 token 到 _to 上，代替 _from 账户</span><br><span class="line">    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) &#123;</span><br><span class="line">        require(_value &lt;= allowance[_from][msg.sender]);     // Check allowance</span><br><span class="line">        allowance[_from][msg.sender] -= _value;</span><br><span class="line">        _transfer(_from, _to, _value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 授权 _spender 使用账户 token</span><br><span class="line">    function approve(address _spender, uint256 _value) public</span><br><span class="line">        returns (bool success) &#123;</span><br><span class="line">        allowance[msg.sender][_spender] = _value;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 销毁 token</span><br><span class="line">    function burn(uint256 _value) public returns (bool success) &#123;</span><br><span class="line">        require(balanceOf[msg.sender] &gt;= _value);   // Check if the sender has enough</span><br><span class="line">        balanceOf[msg.sender] -= _value;            // Subtract from the sender</span><br><span class="line">        totalSupply -= _value;                      // Updates totalSupply</span><br><span class="line">        emit Burn(msg.sender, _value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 销毁其他账户的 token</span><br><span class="line">    function burnFrom(address _from, uint256 _value) public returns (bool success) &#123;</span><br><span class="line">        require(balanceOf[_from] &gt;= _value);                // Check if the targeted balance is enough</span><br><span class="line">        require(_value &lt;= allowance[_from][msg.sender]);    // Check allowance</span><br><span class="line">        balanceOf[_from] -= _value;                         // Subtract from the targeted balance</span><br><span class="line">        allowance[_from][msg.sender] -= _value;             // Subtract from the sender&apos;s allowance</span><br><span class="line">        totalSupply -= _value;                              // Update totalSupply</span><br><span class="line">        emit Burn(_from, _value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/******************************************/</span><br><span class="line">/*               高级自定义               */</span><br><span class="line">/******************************************/</span><br><span class="line"></span><br><span class="line">contract MyAdvancedToken is owned, TokenERC20 &#123;</span><br><span class="line"></span><br><span class="line">    uint256 public sellPrice;</span><br><span class="line">    uint256 public buyPrice;</span><br><span class="line"></span><br><span class="line">    mapping (address =&gt; bool) public frozenAccount;</span><br><span class="line"></span><br><span class="line">    // 触发一个公共事件提醒客户端</span><br><span class="line">    event FrozenFunds(address target, bool frozen);</span><br><span class="line"></span><br><span class="line">    // 合约初始化</span><br><span class="line">    function MyAdvancedToken(</span><br><span class="line">        uint256 initialSupply,</span><br><span class="line">        string tokenName,</span><br><span class="line">        string tokenSymbol</span><br><span class="line">    ) TokenERC20(initialSupply, tokenName, tokenSymbol) public &#123;&#125;</span><br><span class="line"></span><br><span class="line">    // 内部传输，只在合约内部被调用</span><br><span class="line">    function _transfer(address _from, address _to, uint _value) internal &#123;</span><br><span class="line">        require (_to != 0x0);                               // Prevent transfer to 0x0 address. Use burn() instead</span><br><span class="line">        require (balanceOf[_from] &gt;= _value);               // Check if the sender has enough</span><br><span class="line">        require (balanceOf[_to] + _value &gt;= balanceOf[_to]); // Check for overflows</span><br><span class="line">        require(!frozenAccount[_from]);                     // Check if sender is frozen</span><br><span class="line">        require(!frozenAccount[_to]);                       // Check if recipient is frozen</span><br><span class="line">        balanceOf[_from] -= _value;                         // Subtract from the sender</span><br><span class="line">        balanceOf[_to] += _value;                           // Add the same to the recipient</span><br><span class="line">        emit Transfer(_from, _to, _value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 铸币给 target 账户</span><br><span class="line">    function mintToken(address target, uint256 mintedAmount) onlyOwner public &#123;</span><br><span class="line">        balanceOf[target] += mintedAmount;</span><br><span class="line">        totalSupply += mintedAmount;</span><br><span class="line">        emit Transfer(0, this, mintedAmount);</span><br><span class="line">        emit Transfer(this, target, mintedAmount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 冻结账户</span><br><span class="line">    function freezeAccount(address target, bool freeze) onlyOwner public &#123;</span><br><span class="line">        frozenAccount[target] = freeze;</span><br><span class="line">        emit FrozenFunds(target, freeze);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 设置价格</span><br><span class="line">    function setPrices(uint256 newSellPrice, uint256 newBuyPrice) onlyOwner public &#123;</span><br><span class="line">        sellPrice = newSellPrice;</span><br><span class="line">        buyPrice = newBuyPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 购买 token</span><br><span class="line">    function buy() payable public &#123;</span><br><span class="line">        uint amount = msg.value / buyPrice;               // calculates the amount</span><br><span class="line">        _transfer(this, msg.sender, amount);              // makes the transfers</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 售卖 token</span><br><span class="line">    function sell(uint256 amount) public &#123;</span><br><span class="line">        address myAddress = this;</span><br><span class="line">        require(myAddress.balance &gt;= amount * sellPrice);      // checks if the contract has enough ether to buy</span><br><span class="line">        _transfer(msg.sender, this, amount);              // makes the transfers</span><br><span class="line">        msg.sender.transfer(amount * sellPrice);          // sends ether to the seller. It&apos;s important to do this last to avoid recursion attacks</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="二、映射"><a href="#二、映射" class="headerlink" title="二、映射"></a>二、映射</h3><p>EOS 首先是在以太坊上发布代币众筹，后面 EOS  有了自己独立的公链。等众筹结束后，将以太坊上的代币放到 EOS 公链上转成真正的 EOS 币种，用户需要自己做映射。</p>
<h4 id="2-1、映射教程（https-www-zhihu-com-question-265707806-）"><a href="#2-1、映射教程（https-www-zhihu-com-question-265707806-）" class="headerlink" title="2.1、映射教程（https://www.zhihu.com/question/265707806 ）"></a>2.1、映射教程（<a href="https://www.zhihu.com/question/265707806" target="_blank" rel="noopener">https://www.zhihu.com/question/265707806</a> ）</h4><h5 id="2-1-1、到EOS公链上生成EOS密钥对"><a href="#2-1-1、到EOS公链上生成EOS密钥对" class="headerlink" title="2.1.1、到EOS公链上生成EOS密钥对"></a>2.1.1、到EOS公链上生成EOS密钥对</h5><p>生成密钥对的网址:  <a href="https://nadejde.github.io/eos-token-sale/" target="_blank" rel="noopener">https://nadejde.github.io/eos-token-sale/</a><br>密钥对生成网站代码在:  <a href="https://github.com/Nadejde/eos-token-sale/" target="_blank" rel="noopener">https://github.com/Nadejde/eos-token-sale/</a><br>EOS官方的完整代码在:  <a href="https://github.com/EOSIO/eos-token-distribution/" target="_blank" rel="noopener">https://github.com/EOSIO/eos-token-distribution/</a></p>
<h5 id="2-1-2、注册一个-myetherwallet-的钱包，并进行映射"><a href="#2-1-2、注册一个-myetherwallet-的钱包，并进行映射" class="headerlink" title="2.1.2、注册一个 myetherwallet 的钱包，并进行映射"></a>2.1.2、注册一个 myetherwallet 的钱包，并进行映射</h5><h4 id="2-2、映射部分代码"><a href="#2-2、映射部分代码" class="headerlink" title="2.2、映射部分代码"></a>2.2、映射部分代码</h4><p>映射合约源代码： <a href="https://etherscan.io/address/0xd0a6e6c54dbc68db5db3a091b171a77407ff7ccf#code" target="_blank" rel="noopener">https://etherscan.io/address/0xd0a6e6c54dbc68db5db3a091b171a77407ff7ccf#code</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line">contract EOSSale is DSAuth, DSExec, DSMath &#123;</span><br><span class="line">    DSToken  public  EOS;                  // 详情见源代码</span><br><span class="line">    uint128  public  totalSupply;          // Token 总量</span><br><span class="line">    uint128  public  foundersAllocation;   // 开发团队保留份额</span><br><span class="line">    string   public  foundersKey;          // 保留份额 Holder Address</span><br><span class="line"></span><br><span class="line">    uint     public  openTime;             // window 0 开始时间</span><br><span class="line">    uint     public  createFirstDay;       // window 0 供应量</span><br><span class="line"></span><br><span class="line">    uint     public  startTime;            // window 1 开始时间</span><br><span class="line">    uint     public  numberOfDays;         // window 总数</span><br><span class="line">    uint     public  createPerDay;         // 每日供应量</span><br><span class="line">    /**</span><br><span class="line">    * EOS 的 ICO 规则为：前五天为一个 window 总共发行 2 亿 Token。五天之后，每23个小时为一个window，发行 2 百万 Token。总共发行 10 亿 Token</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    mapping (uint =&gt; uint)                       public  dailyTotals;</span><br><span class="line">    mapping (uint =&gt; mapping (address =&gt; uint))  public  userBuys;</span><br><span class="line">    mapping (uint =&gt; mapping (address =&gt; bool))  public  claimed;</span><br><span class="line">    mapping (address =&gt; string)                  public  keys;</span><br><span class="line"></span><br><span class="line">    event LogBuy      (uint window, address user, uint amount);</span><br><span class="line">    event LogClaim    (uint window, address user, uint amount);</span><br><span class="line">    event LogRegister (address user, string key);</span><br><span class="line">    event LogCollect  (uint amount);</span><br><span class="line">    event LogFreeze   ();</span><br><span class="line"></span><br><span class="line">    function EOSSale(</span><br><span class="line">        uint     _numberOfDays,</span><br><span class="line">        uint128  _totalSupply,</span><br><span class="line">        uint     _openTime,</span><br><span class="line">        uint     _startTime,</span><br><span class="line">        uint128  _foundersAllocation,</span><br><span class="line">        string   _foundersKey</span><br><span class="line">    ) &#123;</span><br><span class="line">        numberOfDays       = _numberOfDays;</span><br><span class="line">        totalSupply        = _totalSupply;</span><br><span class="line">        openTime           = _openTime;</span><br><span class="line">        startTime          = _startTime;</span><br><span class="line">        foundersAllocation = _foundersAllocation;</span><br><span class="line">        foundersKey        = _foundersKey;</span><br><span class="line"></span><br><span class="line">        // // window 0 Token 供应量 (由于 solidity 里面没有 float 类型，想要乘以 0.2 可以通过 乘以 0.2 ether 实现)</span><br><span class="line">        createFirstDay = wmul(totalSupply, 0.2 ether);</span><br><span class="line">        // // window 1 以及以后的每天 Token 供应量</span><br><span class="line">        createPerDay = div(</span><br><span class="line">            sub(sub(totalSupply, foundersAllocation), createFirstDay),</span><br><span class="line">            numberOfDays</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        assert(numberOfDays &gt; 0);</span><br><span class="line">        assert(totalSupply &gt; foundersAllocation);</span><br><span class="line">        assert(openTime &lt; startTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function initialize(DSToken eos) auth &#123;</span><br><span class="line">        assert(address(EOS) == address(0));</span><br><span class="line">        assert(eos.owner() == address(this));</span><br><span class="line">        assert(eos.authority() == DSAuthority(0));</span><br><span class="line">        assert(eos.totalSupply() == 0);</span><br><span class="line"></span><br><span class="line">        EOS = eos;</span><br><span class="line">        // mint 方法是 dapp_token 提供，用来设置 Token 供应总量</span><br><span class="line">        EOS.mint(totalSupply);</span><br><span class="line"></span><br><span class="line">        // 开发团队保留的份额被发送到 0xb1 。这个地址是无人可用的，等于丢掉此数量的 Token ，但是又保证 Token 总供应量不变。EOS 团队不需要这个代币，因为在 EOS 上线之后，现在的 Token 会兑换为 EOS 链上的 Token。</span><br><span class="line">        EOS.push(0xb1, foundersAllocation);</span><br><span class="line">        keys[0xb1] = foundersKey;</span><br><span class="line">        LogRegister(0xb1, foundersKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function time() constant returns (uint) &#123;</span><br><span class="line">        return block.timestamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function today() constant returns (uint) &#123;</span><br><span class="line">        return dayFor(time());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 前五天都是 window 0 。之后每23小时为一个 window 。这么做的好处是让每个 window 的开始时间是滚动的，不同时区的投资者更方便参与。</span><br><span class="line">    function dayFor(uint timestamp) constant returns (uint) &#123;</span><br><span class="line">        return timestamp &lt; startTime</span><br><span class="line">            ? 0</span><br><span class="line">            : sub(timestamp, startTime) / 23 hours + 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function createOnDay(uint day) constant returns (uint) &#123;</span><br><span class="line">        return day == 0 ? createFirstDay : createPerDay;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // This method provides the buyer some protections regarding which</span><br><span class="line">    // day the buy order is submitted and the maximum price prior to</span><br><span class="line">    // applying this payment that will be allowed.</span><br><span class="line">    function buyWithLimit(uint day, uint limit) payable &#123;</span><br><span class="line">        // 限制时间</span><br><span class="line">        assert(time() &gt;= openTime &amp;&amp; today() &lt;= numberOfDays);</span><br><span class="line">        assert(msg.value &gt;= 0.01 ether);</span><br><span class="line"></span><br><span class="line">        assert(day &gt;= today());</span><br><span class="line">        assert(day &lt;= numberOfDays);</span><br><span class="line"></span><br><span class="line">        // 购买记录</span><br><span class="line">        userBuys[day][msg.sender] += msg.value;</span><br><span class="line">        dailyTotals[day] += msg.value;</span><br><span class="line"></span><br><span class="line">        if (limit != 0) &#123;</span><br><span class="line">            assert(dailyTotals[day] &lt;= limit);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LogBuy(day, msg.sender, msg.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function buy() payable &#123;</span><br><span class="line">       buyWithLimit(today(), 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function () payable &#123;</span><br><span class="line">       buy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function claim(uint day) &#123;</span><br><span class="line">        assert(today() &gt; day);</span><br><span class="line">        </span><br><span class="line">        // 防止重复兑换</span><br><span class="line">        if (claimed[day][msg.sender] || dailyTotals[day] == 0) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // This will have small rounding errors, but the token is</span><br><span class="line">        // going to be truncated to 8 decimal places or less anyway</span><br><span class="line">        // when launched on its own chain.</span><br><span class="line"></span><br><span class="line">        var dailyTotal = cast(dailyTotals[day]);</span><br><span class="line">        var userTotal  = cast(userBuys[day][msg.sender]);</span><br><span class="line">        // 指定 window 的 Token 供应量除以此 window 的 eth 总量，得到兑换比例</span><br><span class="line">        var price      = wdiv(cast(createOnDay(day)), dailyTotal);</span><br><span class="line">        // 兑换比例乘以指定 window 中此用户支付的 eth 数量得到兑换总量</span><br><span class="line">        var reward     = wmul(price, userTotal);</span><br><span class="line"></span><br><span class="line">        // 记录兑换标志</span><br><span class="line">        claimed[day][msg.sender] = true;</span><br><span class="line">        // 执行转账</span><br><span class="line">        EOS.push(msg.sender, reward);</span><br><span class="line"></span><br><span class="line">        LogClaim(day, msg.sender, reward);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function claimAll() &#123;</span><br><span class="line">        for (uint i = 0; i &lt; today(); i++) &#123;</span><br><span class="line">            claim(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 注册 EOS 共钥，EOS 团队要求投资者在众筹结束之前自行生成 EOS 公私钥，并将生成的共钥注册在合约中。这样在 EOS 正式上线之后，用户可以兑换 EOS 上的 Token 。</span><br><span class="line">    function register(string key) &#123;</span><br><span class="line">        assert(today() &lt;=  numberOfDays + 1);</span><br><span class="line">        assert(bytes(key).length &lt;= 64);</span><br><span class="line"></span><br><span class="line">        keys[msg.sender] = key;</span><br><span class="line"></span><br><span class="line">        LogRegister(msg.sender, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ETH 转移（auth 是 dapp_auth 提供的权限控制方法，保证 collect 函数只能被合约 owner 执行）</span><br><span class="line">    function collect() auth &#123;</span><br><span class="line">        assert(today() &gt; 0); // window 0 不能转移</span><br><span class="line">        exec(msg.sender, this.balance);  // 将 eth 转移给调用者</span><br><span class="line">        LogCollect(this.balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Anyone can freeze the token 1 day after the sale ends</span><br><span class="line">    function freeze() &#123;</span><br><span class="line">        assert(today() &gt; numberOfDays + 1);</span><br><span class="line">        EOS.stop();</span><br><span class="line">        LogFreeze();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="三、钱包"><a href="#三、钱包" class="headerlink" title="三、钱包"></a>三、钱包</h3><h4 id="3-1、钱包简介"><a href="#3-1、钱包简介" class="headerlink" title="3.1、钱包简介"></a>3.1、钱包简介</h4><p>区块链钱包目前很多人的认识就是数字资产的管理软件，用来转账和收款。由于区块链只要私钥丢失，就意味着所有的数字资产很容易就可以被人盗走，所以私钥通常都是保存在本地。私钥保存在本地的代价就是任何区块链交易都需要在本地完成私钥签名，才能将整个交易流程走通，这就使得现有的很多 DAPP 无法做到无缝地体验，换言之区块链钱包之于 DAPP，就如同支付宝之于各种电商 APP。 </p>
<p>支付宝占据了人民币交易的大部分市场份额，于是支付宝就成了很多交易场景无法绕过去的支付工具，我们熟悉的电商、旅游订票、知识服务等平台，都会在手机端唤起支付宝APP完成最终的支付流程。同样的，区块链上的数字资产未来极有可能也会因为大规模 DAPP 的出现而使得交易更加频繁，于是方便快捷的钱包产品就显得非常有必要了。</p>
<h4 id="3-2、钱包之应用分发中心"><a href="#3-2、钱包之应用分发中心" class="headerlink" title="3.2、钱包之应用分发中心"></a>3.2、钱包之应用分发中心</h4><p>有人调研了国内外很多区块链钱包产品，很多钱包已经开始集成有限的 DAPP 了，用户在使用 DAPP 时，只要有需要支付交易的场景，都会唤起本地钱包完成私钥签名和支付，这就像很多第三方电商 APP 会在需要交易的时候唤起支付宝。区块链钱包的价值就在于给各种第三方 DAPP 提供了一套完整的支付体验流程，基于此，我们有理由相信未来的钱包很有可能会是一个应用分发中心。</p>
<p>过往很多商业模式都是基于流量思维，对于线下零售来说，好地段永远都是最重要的选址标准，因为好地段就意味着大流量。同样的，对于互联网应用来说，流量依然是大家极其看重的指标，微信垄断了社交流量、阿里垄断了电商流量、百度垄断了搜索流量、抖音垄断了短视频流量等等，对于一家手握大量流量的公司来说，商业变现都是迟早的事情。</p>
<h4 id="3-3、钱包拓展背景"><a href="#3-3、钱包拓展背景" class="headerlink" title="3.3、钱包拓展背景"></a>3.3、钱包拓展背景</h4><p>在区块链领域，过去很多人都觉得中心化的交易所未来极有可能是流量入口，但是从过往交易所监守自盗的劣迹来看，人们极有可能会最终抛弃中心化交易所。数字资产交易所和传统的股票交易所本质上并没有太大的区别，数字资产交易所今天上演的各种行为，在很多人看来完全是在复制早期股票交易所，所不同的是，数字资产交易所未来是否会引入监管还存在极大的不确定性。于是各种内幕交易、操盘价格走势，再加上做空和期货的引入，交易所既可以成倍放大收益，也可以成倍放大市场的恐慌情绪。</p>
<p>最重要的一点是人们在交易所上存放的数字资产本质上并不掌握所有权，人们只是把数字资产转到了交易所指定的账号上，由交易所代为管理。所以交易所完全有可能直接用这些数字资产去做短期套利，而只需要在个人账户界面上显示原来的余额即可。对于刚刚过去的 EOS 投票上线主网，由于散户的投票热情很低，EOS 因为投票率低迟迟无法上线主网，最后是交易所推高了投票率，才使得 EOS 主网最终上线主网，那么我们就有理由相信交易所私自动用了未经用户授权的 EOS，强行代用户进行了投票。     </p>
<p>最后最为致命的一点就是交易所由于缺乏监管，理论上完全有可能携款跑路，至少目前国家法律并不保护用户的数字资产，所以散户们除了道德谴责好像也找不到更好的维权途径，不要以为我在危言耸听，很多小规模的交易所已经开始无法提现了。</p>
<h4 id="3-4、DAPP-的价值"><a href="#3-4、DAPP-的价值" class="headerlink" title="3.4、DAPP 的价值"></a>3.4、DAPP 的价值</h4><p>钱包由于满足了用户管理数字资产的刚需，所以用户量可以做到很高，今天中国币圈投资者基本上没有人不知道 imToken 钱包的。随着去中心化交易所技术的不断改善和提高，我们有理由相信钱包内置去中心化交易平台会是一个大趋势，一旦人们的交易需求被满足，那么人们极有可能会抛弃中心化交易所。</p>
<p>除了交易需求，未来更大的想象空间应该来自 DAPP 的大爆发，互联网以及随后的移动互联网最为火热的阶段都是大量应用层出不穷的时候，诞生了很多世界级的大公司，人们也因此享受到了更加便捷的生活方式。我们有理由相信随着区块链基础设施的不断完善，未来基于区块链的去中心化应用（DAPP）会开始呈现爆发的态势。</p>
<p>Token 可以让区块链上的信息以极低的成本在用户之间完成交易，智能合约则可以通过代码编程的方式定制利益分配规则，促成更多的分工合作。当越来越多的 DAPP 爆发时，所有的交易都需要私钥签名，出于安全性考虑，私钥又不得不放在钱包 APP 中，所以就需要钱包充当媒介为 DAPP 提供最终的支付解决方案。如果钱包本身就是一个应用分发中心的话，那么就意味着人们可以在钱包中使用完成从 DAPP 体验到支付的所有环节。</p>
<h4 id="3-5、多链资产和跨链交易"><a href="#3-5、多链资产和跨链交易" class="headerlink" title="3.5、多链资产和跨链交易"></a>3.5、多链资产和跨链交易</h4><p>如果未来钱包真的要充当应用分发中心和支付媒介，那么就肯定会有多链资产和跨链交易的需求，目前我们看到的很多钱包都还是只支持单一区块链平台，随着区块链开始在各个行业渗透，未来的钱包大概率会出现多条链并存，DAPP 横跨多条链的场景。</p>
<p>想象一下，如果一款钱包可以同时支持比特币、以太坊以及各种 ERC20 代币、EOS、IOTA 等，是不是会觉得非常方便，如果还能在钱包中完成这几种资产的比例自由配置，估计币圈的投资者会有一种相见恨晚的感觉。</p>
<p>我们不妨再想象一下，如果今天的加密猫游戏不仅仅是基于以太坊的 ERC721 代币，还包括其他区块链数字货币，那么游戏体验会不会更好，用户可以通过比特币充值，然后用以太币完成交易，还可以换成某条侧链上的资产去玩其他周边游戏，比如说给猫买一顶帽子等。一旦跨链交易成为可能，游戏的扩展性和可玩性都会得到极大的提高。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-09-29T09:13:45.864Z" itemprop="dateUpdated">2019-09-29 17:13:45</time>
</span><br>


        
        本文地址：<a href="/project/token/" target="_blank" rel="external">http://blog.master-ss.cn/project/token/</a>
        
    </div>
    
    <footer>
        <a href="http://blog.master-ss.cn">
            <img src="/img/avatar.png" alt="张松松">
            张松松
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.master-ss.cn/project/token/&title=《blockchain 之 eth 发币、映射、钱包》 — 青松的博客&pic=http://blog.master-ss.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.master-ss.cn/project/token/&title=《blockchain 之 eth 发币、映射、钱包》 — 青松的博客&source=这章介绍以太坊发币，映射 eos 公链和钱包开发价值。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.master-ss.cn/project/token/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《blockchain 之 eth 发币、映射、钱包》 — 青松的博客&url=http://blog.master-ss.cn/project/token/&via=http://blog.master-ss.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.master-ss.cn/project/token/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/project/eth/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">blockchain 之 eth 钱包实战</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/project/eos/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">blockchain 之 eos 钱包实战</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "wUJ09egw1xIlxVQMQzLGKT4M-gzGzoHsz",
            appKey: "2Vk9VCblILWnai3FCQ0iQogY",
            avatar: "mm",
            placeholder: "写点什么？",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->







</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>张松松 &copy; 2016 - 2019</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">赣ICP备18001386号-1</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.master-ss.cn/project/token/&title=《blockchain 之 eth 发币、映射、钱包》 — 青松的博客&pic=http://blog.master-ss.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.master-ss.cn/project/token/&title=《blockchain 之 eth 发币、映射、钱包》 — 青松的博客&source=这章介绍以太坊发币，映射 eos 公链和钱包开发价值。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.master-ss.cn/project/token/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《blockchain 之 eth 发币、映射、钱包》 — 青松的博客&url=http://blog.master-ss.cn/project/token/&via=http://blog.master-ss.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.master-ss.cn/project/token/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAAByklEQVR42u3aQW6EMAwF0Ln/padSV60q4NsOYSq9rBADmZeNlXzzesXj/T1+Xh/dOfr1fM7FAxcXd8x9n45k6uTd8zkTAy4u7n5uXrz+Pp8sJr++mBkXF/fDuEfPH91JyhYuLu5/5+al7Zy+te7i4uIOuPkBphedVLdQC85quLi4A24vMF17fXu+i4uLu6grkRSU6kZn9O+4uLhbuHnMkdxPFlY9XL2qE+Hi4o65eWDRK22T7dRhCcPFxd3CzQ85SVyyNl75dQcXF/ch7qomyoR7+CQuLu5Gbu/TzKRszd89THFwcXFv4ybFJZpicLwpx6+4uLg3c3sbjkmYksSv5VXi4uLewO2x8k1JErVEM+Di4m7h9qKQ+VvVLRQuLu5O7gSRNGCqs114cHFxt3CrRar6wcRkA1QOTHFxcRdx362RZxR5CBKVNlxc3I3carQ6QY+aLri4uBu51RI2L1vNheHi4m7h9vqb1Wgj+bBjcvTCxcW9g1s96vRKXjJPtGBcXNyN3GrxytulvY/ALvJdXFzcj+Hm0IvuTXGR0Z/h4uJ+AHeycak2WXFxcZ/iJoefXsGqLmxZLIKLizvg9gLTajOm2rjFxcV9iPsFzKrnHoU3dDEAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
